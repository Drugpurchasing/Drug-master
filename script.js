 const drugs = {
        Oxaliplatin: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 1104 }, { size: 50, cost: 565 }]
        }, 
         Capecitabine: {
            uom: 'เม็ด',
            vials: [{ size: 500, cost: 26.5 }]
        }, 
         Irinotecan: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 1711 }, { size: 40, cost: 872 }]
        }, 
         Leucovorin: {
            uom: 'ไวแอล',
            vials: [{ size: 300, cost: 339 }, { size: 50, cost: 91 }]
        }, 
         Fluorouracil: {
            uom: 'ไวแอล',
            vials: [{ size: 1000, cost: 180 }]
        }, 
         Docetaxel: {
            uom: 'ไวแอล',
            vials: [{ size: 80, cost: 3945 }, { size: 20, cost: 1131 }]
        }, 
         Cisplatin: {
            uom: 'ไวแอล',
            vials: [{ size: 50, cost: 294 }]
        }, 
         Carboplatin: {
            uom: 'ไวแอล',
            vials: [{ size: 450, cost: 934 }, { size: 150, cost: 493 }]
        }, 
         Avastin_Bevacizumab: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 7764 }]
        }, 
         Mvasi_Bevacizumab: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 3592 }]
        }, 
         MitomycinC: {
            uom: 'ไวแอล',
            vials: [{ size: 10, cost: 816 }]
        }, 
         Panitumumab: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 9077 }]
        }, 
         Doxorubicin: {
            uom: 'ไวแอล',
            vials: [{ size: 50, cost: 282 }, { size: 10, cost: 127 }]
        }, 
         Cyclophosphamide: {
            uom: 'ไวแอล',
            vials: [{ size: 1000, cost: 497 }, { size: 200, cost: 106 }]
        }, 
         Paclitaxel: {
            uom: 'ไวแอล',
            vials: [{ size: 300, cost: 1709 }, { size: 100, cost: 712 }, { size: 30, cost: 176 }]
        }, 
         Methotrexate: {
            uom: 'ไวแอล',
            vials: [{ size: 50, cost: 109 }, { size: 5000, cost: 5475 }]
        }, 
         Cyclophosphamide_Oral: {
            uom: 'เม็ด',
            vials: [{ size: 50, cost: 497 }]
        }, 
         Herceptin_Trastuzumab: {
            uom: 'ไวแอล',
            vials: [{ size: 440, cost: 106 }]
        }, 
         Herzuma_Trastuzumab: {
            uom: 'ไวแอล',
            vials: [{ size: 440, cost: 10124 }]
        }, 
         Ogivri_Trastuzumab: {
            uom: 'ไวแอล',
            vials: [{ size: 440, cost: 10654 }]
        }, 
         Herceptin_SC_Trastuzumab: {
            uom: 'ไวแอล',
            vials: [{ size: 600, cost: 28111 }]
        }, 
         Gemcitabine: {
            uom: 'ไวแอล',
            vials: [{ size: 1400, cost: 1356 }, { size: 200, cost: 380 }]
        }, 
         Eribulin: {
            uom: 'ไวแอล',
            vials: [{ size: 1, cost: 11772 }]
        }, 
         Pertuzumab: {
            uom: 'ไวแอล',
            vials: [{ size: 420, cost: 76566 }]
        }, 
         Vinblastine: {
            uom: 'ไวแอล',
            vials: [{ size: 10, cost: 465 }]
        }, 
         Etoposide: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 239 }]
        }, 
         Bleomycin: {
            uom: 'ไวแอล',
            vials: [{ size: 15, cost: 988 }]
        }, 
         Pemintas_Pemetrexed: {
            uom: 'ไวแอล',
            vials: [{ size: 500, cost: 14361 }, { size: 100, cost: 0 }]
        }, 
         Alimta_Pemetrexed: {
            uom: 'ไวแอล',
            vials: [{ size: 500, cost: 25955 }, { size: 100, cost: 9195 }]
        }, 
         Truxima_Rituximab: {
            uom: 'ไวแอล',
            vials: [{ size: 500, cost: 7600 }, { size: 100, cost: 2200 }]
        }, 
         Mabthera_SC_Rituximab: {
            uom: 'ไวแอล',
            vials: [{ size: 1400, cost: 32487 }]
        }, 
         Vincristine: {
            uom: 'ไวแอล',
            vials: [{ size: 1, cost: 172 }]
        }, 
         Mesna: {
            uom: 'แอมป์',
            vials: [{ size: 400, cost: 112 }]
        }, 
         Cytozar_Cytarabine: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 374 }]
        }, 
         Methylprednisolone: {
            uom: 'ไวแอล',
            vials: [{ size: 40, cost: 220 }, { size: 500, cost: 1790 }]
        }, 
         Cytarabine: {
            uom: 'ไวแอล',
            vials: [{ size: 1000, cost: 694 }, { size: 100, cost: 134 }]
        }, 
         Ifosfamide: {
            uom: 'ไวแอล',
            vials: [{ size: 1000, cost: 1415 }]
        }, 
         Brentuximab: {
            uom: 'ไวแอล',
            vials: [{ size: 50, cost: 126589 }]
        }, 
         Leunase_asparagenase: {
            uom: 'ไวแอล',
            vials: [{ size: 10000, cost: 4769 }]
        }, 
         Etoposide_Oral: {
            uom: 'เม็ด',
            vials: [{ size: 50, cost: 319 }]
        }, 
         Mannitol: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 59.5 }]
        }, 
         Bendamustine: {
            uom: 'ไวแอล',
            vials: [{ size: 100, cost: 5630 }, { size: 25, cost: 1410 }]
        }, 
         Obinutuzumab: {
            uom: 'ไวแอล',
            vials: [{ size: 1000, cost: 126953 }]
        }, 
         Polatuzumab: {
            uom: 'ไวแอล',
            vials: [{ size: 140, cost: 300196 }]
        }, 
         Mitoxanthrone: {
            uom: 'ไวแอล',
            vials: [{ size: 20, cost: 7062 }]
        }, 
        
        
    };

    const regimens = {
        UGI01100XELOX: { name:"UGI01100XELOX", drugs: [{ name:"Capecitabine", dosePerM2:2000,days:14}, { name:"Oxaliplatin", dosePerM2:130,days:1}]},
UGI000901FOLFIRI46hr: { name:"UGI000901FOLFIRI46hr", drugs: [{ name:"Leucovorin", dosePerM2:400,days:1}, { name:"Irinotecan", dosePerM2:180,days:1}]},
UGI000900FOLFIRI: { name:"UGI000900FOLFIRI", drugs: [{ name:"Leucovorin", dosePerM2:400,days:1}, { name:"Irinotecan", dosePerM2:180,days:1}]},
UGI00800Capecitabine: { name:"UGI00800Capecitabine", drugs: [{ name:"Capecitabine", dosePerM2:2000,days:14}]},
UGI00700TPF: { name:"UGI00700TPF", drugs: [{ name:"Cisplatin", dosePerM2:75,days:1}, { name:"Fluorouracil", dosePerM2:1000,days:4,},{ name:"Docetaxel", dosePerM2:75,days:1},]},
UGI00600Docetaxel: { name:"UGI00600Docetaxel", drugs: [{ name:"Docetaxel", dosePerM2:75,days:1}]},
UGI00501Irinotecan: { name:"UGI00501Irinotecan", drugs: [{ name:"Irinotecan", dosePerM2:125,days:1}]},
UGI00500Irinotecan: { name:"UGI00500Irinotecan", drugs: [{ name:"Irinotecan", dosePerM2:350,days:1}]},
UGI00402mFOLFOX6_46Hr: { name:"UGI00402mFOLFOX6_46Hr", drugs: [{ name:"Leucovorin", dosePerM2:400,days:1}, { name:"Fluorouracil", dosePerM2:2800,days:1,},{ name:"Oxaliplatin", dosePerM2:85,days:1},]},
UGI00401FOLFOX6: { name:"UGI00401FOLFOX6", drugs: [{ name:"Leucovorin", dosePerM2:400,days:1}, { name:"Fluorouracil", dosePerM2:2800,days:1,},{ name:"Oxaliplatin", dosePerM2:85,days:1},]},
UGI00400FLO: { name:"UGI00400FLO", drugs: [{ name:"Leucovorin", dosePerM2:200,days:1}, { name:"Fluorouracil", dosePerM2:2600,days:1,},{ name:"Oxaliplatin", dosePerM2:85,days:1},]},
UGI00300Carboplatin5FU: { name:"UGI00300Carboplatin/5-FU", drugs: [{ name:"Fluorouracil", dosePerM2:1000,days:4}, { name:"Carboplatin", dosePerM2:5,days:4}]},
UGI00200Cisplatin5FU: { name:"UGI00200Cisplatin/5-FU", drugs: [{ name:"Fluorouracil", dosePerM2:1000,days:4}, { name:"Cisplatin", dosePerM2:80,days:4}]},
UGI00100Macdonald: { name:"UGI00100Macdonald", drugs: [{ name:"Fluorouracil", dosePerM2:425,days:5}, { name:"Leucovorin", dosePerM2:20,days:5}]},
CRC00100FOLFOX4: { name:"CRC00100FOLFOX4", drugs: [{ name:"Leucovorin", dosePerM2:200,days:2}, { name:"Fluorouracil", dosePerM2:1000,days:2,},{ name:"Oxaliplatin", dosePerM2:85,days:1},]},
CRC00101mFOLFOX6: { name:"CRC00101mFOLFOX6", drugs: [{ name:"Leucovorin", dosePerM2:400,days:1}, { name:"Fluorouracil", dosePerM2:2800,days:1,},{ name:"Oxaliplatin", dosePerM2:85,days:1},]},
CRC00102mFOLFOX6_Home: { name:"CRC00102mFOLFOX6_Home", drugs: [{ name:"Leucovorin", dosePerM2:400,days:1}, { name:"Fluorouracil", dosePerM2:2800,days:1,},{ name:"Oxaliplatin", dosePerM2:85,days:1},]},
CRC00200Mayo: { name:"CRC00200Mayo", drugs: [{ name:"Leucovorin", dosePerM2:20,days:5}, { name:"Fluorouracil", dosePerM2:400,days:5}]},
CRC00201MayoRT: { name:"CRC00201Mayo/RT", drugs: [{ name:"Leucovorin", dosePerM2:20,days:5}, { name:"Fluorouracil", dosePerM2:400,days:5}]},
CRC00300FOLFIRI22hr: { name:"CRC00300FOLFIRI22hr", drugs: [{ name:"Leucovorin", dosePerM2:200,days:2}, { name:"Fluorouracil", dosePerM2:1000,days:2,},{ name:"Irinotecan", dosePerM2:180,days:1},]},
CRC00302mFOLFIRI: { name:"CRC00302mFOLFIRI", drugs: [{ name:"Leucovorin", dosePerM2:400,days:2}, { name:"Fluorouracil", dosePerM2:2800,days:2,},{ name:"Irinotecan", dosePerM2:180,days:1},]},
CRC00303mFOLFIRIHome: { name:"CRC00303mFOLFIRIHome", drugs: [{ name:"Leucovorin", dosePerM2:400,days:1}, { name:"Fluorouracil", dosePerM2:2800,days:1,},{ name:"Irinotecan", dosePerM2:180,days:1},]},
CRC00400Roswell: { name:"CRC00400Roswell", drugs: [{ name:"Fluorouracil", dosePerM2:500,days:6}, { name:"Leucovorin", dosePerM2:500,days:6}]},
CRC00500FLOX: { name:"CRC00500FLOX", drugs: [{ name:"Leucovorin", dosePerM2:500,days:6}, { name:"Fluorouracil", dosePerM2:500,days:6,},{ name:"Oxaliplatin", dosePerM2:85,days:3},]},
CRC00600Capecitabine: { name:"CRC00600Capecitabine", drugs: [{ name:"Capecitabine", dosePerM2:2000,days:14}]},
CRC00601CapecitabineXRT: { name:"CRC00601Capecitabine/XRT", drugs: [{ name:"Capecitabine", dosePerM2:1650,days:14}]},
CRC00700XELOX: { name:"CRC00700XELOX", drugs: [{ name:"Capecitabine", dosePerM2:2000,days:14}, { name:"Oxaliplatin", dosePerM2:130,days:1}]},
CRC00800Bevacizumab: { name:"CRC00800Bevacizumab", drugs: [{ name:"Avastin_Bevacizumab", dosePerM2:5,days:1}]},
CRC00800Bevacizumab: { name:"CRC00800Bevacizumab", drugs: [{ name:"Mvasi_Bevacizumab", dosePerM2:5,days:1}]},
CRC01000Irinotecan: { name:"CRC01000Irinotecan", drugs: [{ name:"Irinotecan", dosePerM2:350,days:1}]},
CRC01100FUMitomycinC: { name:"CRC01100FU/MitomycinC", drugs: [{ name:"Fluorouracil", dosePerM2:1000,days:4}, { name:"MitomycinC", dosePerM2:10,days:1}]},
CRC012005FULV: { name:"CRC012005FU+LV", drugs: [{ name:"Fluorouracil", dosePerM2:2800,days:1}, { name:"Leucovorin", dosePerM2:400,days:1}]},
CRC01300Panitumumab: { name:"CRC01300Panitumumab", drugs: [{ name:"Panitumumab", dosePerM2:6,days:1}]},
BRE00101AC: { name:"BRE00101AC", drugs: [{ name:"Cyclophosphamide", dosePerM2:600,days:1}, { name:"Doxorubicin", dosePerM2:60,days:1}]},
BRE00300TC: { name:"BRE00300TC", drugs: [{ name:"Cyclophosphamide", dosePerM2:600,days:1}, { name:"Docetaxel", dosePerM2:75,days:1}]},
BRE00400Paclitaxel_weekly: { name:"BRE00400Paclitaxel_weekly", drugs: [{ name:"Paclitaxel", dosePerM2:80,days:1}]},
BRE00401Paclitaxel_Q3W: { name:"BRE00401Paclitaxel_Q3W", drugs: [{ name:"Paclitaxel", dosePerM2:175,days:1}]},
BRE00500Docetaxel_Q3W: { name:"BRE00500Docetaxel_Q3W", drugs: [{ name:"Docetaxel", dosePerM2:100,days:1}]},
BRE00600FAC: { name:"BRE00600FAC", drugs: [{ name:"Cyclophosphamide", dosePerM2:500,days:1}, { name:"Fluorouracil", dosePerM2:500,days:1,},{ name:"Doxorubicin", dosePerM2:50,days:1},]},
BRE00800OralCMF: { name:"BRE00800OralCMF", drugs: [{ name:"Fluorouracil", dosePerM2:600,days:1}, { name:"Cyclophosphamide_Oral", dosePerM2:100,days:1,},{ name:"Methotrexate", dosePerM2:40,days:1},]},
BRE00900Trastuzumab_Q3W_HerSC: { name:"BRE00900Trastuzumab_Q3W_HerSC", drugs: [{ name:"Herceptin_SC_Trastuzumab", fixedDose:600,days:1}]},
BRE00900Trastuzumab_Q3W_Herceptin: { name:"BRE00900Trastuzumab_Q3W_Herceptin", drugs: [{ name:"Herceptin_Trastuzumab", dosePerM2:8,days:1}]},
BRE00900Trastuzumab_Q3W: { name:"BRE00900Trastuzumab_Q3W", drugs: [{ name:"Herzuma_Trastuzumab", dosePerM2:8,days:1}]},
BRE00901Trastuzumab_Q1W_Herceptin: { name:"BRE00901Trastuzumab_Q1W_Herceptin", drugs: [{ name:"Herceptin_Trastuzumab", dosePerM2:4,days:1}]},
BRE00901Trastuzumab_Q1W: { name:"BRE00901Trastuzumab_Q1W", drugs: [{ name:"Herzuma_Trastuzumab", dosePerM2:4,days:1}]},
BRE01000Doxorubicin: { name:"BRE01000Doxorubicin", drugs: [{ name:"Doxorubicin", dosePerM2:50,days:1}]},
BRE01100Capecitabine: { name:"BRE01100Capecitabine", drugs: [{ name:"Capecitabine", dosePerM2:2000,days:14}]},
BRE01400Gemcitabine: { name:"BRE01400Gemcitabine", drugs: [{ name:"Gemcitabine", dosePerM2:1200,days:1}]},
BRE01500GemcitabineCarboplatin: { name:"BRE01500Gemcitabine+Carboplatin", drugs: [{ name:"Carboplatin", dosePerM2:2,days:1}, { name:"Gemcitabine", dosePerM2:1000,days:1}]},
BRE01600CarboplatinPaclitaxel: { name:"BRE01600Carboplatin+Paclitaxel", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}, { name:"Paclitaxel", dosePerM2:175,days:1}]},
BRE01700Eribulin: { name:"BRE01700Eribulin", drugs: [{ name:"Eribulin", dosePerM2:1.4,days:1}]},
BRE01800Pertuzumab_Q3W: { name:"BRE01800Pertuzumab_Q3W", drugs: [{ name:"Pertuzumab", dosePerM2:2,days:1}]},
BRE01900DocetaxelCarboplatin: { name:"BRE01900Docetaxel+Carboplatin", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}, { name:"Docetaxel", dosePerM2:75,days:1}]},
PAN00100Single_Gemcitabine: { name:"PAN00100Single_Gemcitabine", drugs: [{ name:"Gemcitabine", dosePerM2:1000,days:1}]},
PAN00101Single_GemcitabineXRT: { name:"PAN00101Single_Gemcitabine/XRT", drugs: [{ name:"Gemcitabine", dosePerM2:300,days:1}]},
PAN00200GEMOX: { name:"PAN00200GEMOX", drugs: [{ name:"Oxaliplatin", dosePerM2:100,days:1}, { name:"Gemcitabine", dosePerM2:1000,days:1}]},
PAN00300GEMCAPE: { name:"PAN00300GEMCAPE", drugs: [{ name:"Capecitabine", dosePerM2:2000,days:14}, { name:"Gemcitabine", dosePerM2:1000,days:1}]},
PAN00400FOLFIRINOX: { name:"PAN00400FOLFIRINOX", drugs: [{ name:"Oxaliplatin", dosePerM2:85,days:1}, { name:"Irinotecan", dosePerM2:180,days:1},{name:"Leucovorin", dosePerM2:400,days:1},{name:"Fluorouracil", dosePerM2:2800,days:1,}],},
PAN005005FULV: { name:"PAN005005FU/LV", drugs: [{ name:"Fluorouracil", dosePerM2:425,days:5}, { name:"Leucovorin", dosePerM2:20,days:5}]},
PAN005015FULV_XRT: { name:"PAN005015FU/LV_XRT", drugs: [{ name:"Fluorouracil", dosePerM2:425,days:5}, { name:"Leucovorin", dosePerM2:20,days:5}]},
PAN00600FOLFOX4: { name:"PAN00600FOLFOX4", drugs: [{ name:"Leucovorin", dosePerM2:200,days:2}, { name:"Fluorouracil", dosePerM2:1000,days:2,},{ name:"Oxaliplatin", dosePerM2:85,days:1},]},
GUR00100Cisplatingemcitabine: { name:"GUR00100Cisplatin/gemcitabine", drugs: [{ name:"Gemcitabine", dosePerM2:1000,days:1}, { name:"Cisplatin", dosePerM2:100,days:1}]},
GUR00200CarboplatinGemcitabine: { name:"GUR00200Carboplatin/Gemcitabine", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}, { name:"Gemcitabine", dosePerM2:1000,days:1}]},
GUR00300CMV: { name:"GUR00300CMV", drugs: [{ name:"Vinblastine", dosePerM2:3,days:1}, { name:"Cisplatin", dosePerM2:70,days:1,},{ name:"Methotrexate", dosePerM2:30,days:1},]},
GUR00800CarboplatinPaclitaxel: { name:"GUR00800Carboplatin/Paclitaxel", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}, { name:"Paclitaxel", dosePerM2:175,days:1}]},
GUR00900Paclitaxel_q1w: { name:"GUR00900Paclitaxel_q1w", drugs: [{ name:"Paclitaxel", dosePerM2:80,days:1}]},
GUR00901Paclitaxel_q3w: { name:"GUR00901Paclitaxel_q3w", drugs: [{ name:"Paclitaxel", dosePerM2:175,days:1}]},
GUR01000Docetaxel: { name:"GUR01000Docetaxel", drugs: [{ name:"Docetaxel", dosePerM2:60,days:1}]},
GUR01100BEP: { name:"GUR01100BEP", drugs: [{ name:"Cisplatin", dosePerM2:20,days:1}, { name:"Carboplatin", dosePerM2:6,days:1},{name:"Etoposide", dosePerM2:100,days:1},{name:"Bleomycin", dosePerM2:30,days:1,}],},
NSL00100CisplatinGemcitabine: { name:"NSL00100Cisplatin/Gemcitabine", drugs: [{ name:"Gemcitabine", dosePerM2:1000,days:1}, { name:"Cisplatin", dosePerM2:80,days:1}]},
NSL00200CisplatinEtoposide: { name:"NSL00200Cisplatin/Etoposide", drugs: [{ name:"Etoposide", dosePerM2:100,days:1}, { name:"Cisplatin", dosePerM2:100,days:1}]},
NSL00201CisplatinEtoposide_RT: { name:"NSL00201Cisplatin/Etoposide_RT", drugs: [{ name:"Etoposide", dosePerM2:50,days:1}, { name:"Cisplatin", dosePerM2:50,days:1}]},
NSL00300CisplatinVinorelbine: { name:"NSL00300Cisplatin/Vinorelbine", drugs: [{ name:"Cisplatin", dosePerM2:30,days:1}]},
NSL00400CisplatinPemetrexed: { name:"NSL00400Cisplatin/Pemetrexed", drugs: [{ name:"Cisplatin", dosePerM2:75,days:1}, { name:"Pemintas_Pemetrexed", dosePerM2:500,days:1}]},
NSL00400CisplatinPemetrexed_Alimta: { name:"NSL00400Cisplatin/Pemetrexed_Alimta", drugs: [{ name:"Cisplatin", dosePerM2:75,days:1}, { name:"Alimta_Pemetrexed", dosePerM2:500,days:1}]},
NSL00500CarboplatinGemcitabine: { name:"NSL00500Carboplatin/Gemcitabine", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}, { name:"Gemcitabine", dosePerM2:1000,days:1}]},
NSL00600CarboplatinPaclitaxel: { name:"NSL00600Carboplatin/Paclitaxel", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}, { name:"Paclitaxel", dosePerM2:175,days:1}]},
NSL00601CarboplatinPaclitaxel_RT: { name:"NSL00601Carboplatin/Paclitaxel_RT", drugs: [{ name:"Carboplatin", dosePerM2:2,days:1}, { name:"Paclitaxel", dosePerM2:50,days:1}]},
NSL00700CarboplatinEtoposide: { name:"NSL00700Carboplatin/Etoposide", drugs: [{ name:"Etoposide", dosePerM2:100,days:1}, { name:"Carboplatin", dosePerM2:5,days:1}]},
NSL00800VinorelbineCarboplatin: { name:"NSL00800Vinorelbine/Carboplatin", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}]},
NSL00900CarboplatinPemetrexed_Alimta: { name:"NSL00900Carboplatin/Pemetrexed_Alimta", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}, { name:"Alimta_Pemetrexed", dosePerM2:500,days:1}]},
NSL00900CarboplatinPemetrexed: { name:"NSL00900Carboplatin/Pemetrexed", drugs: [{ name:"", dosePerM2:5,days:1}, { name:"Pemintas_Pemetrexed", dosePerM2:500,days:1}]},
NSL01000CarboplatinDocetaxel: { name:"NSL01000Carboplatin/Docetaxel", drugs: [{ name:"Carboplatin", dosePerM2:6,days:1}, { name:"Docetaxel", dosePerM2:75,days:1}]},
NSL01100Gemcitabine: { name:"NSL01100Gemcitabine", drugs: [{ name:"Gemcitabine", dosePerM2:1250,days:1}]},
NSL01300Docetaxel: { name:"NSL01300Docetaxel", drugs: [{ name:"Docetaxel", dosePerM2:75,days:1}]},
NSL01400Pemetrexed_Alimta: { name:"NSL01400Pemetrexed_Alimta", drugs: [{ name:"", dosePerM2:500,days:1}, { name:"Alimta_Pemetrexed", dosePerM2:500,days:1}]},
NSL01400Pemetrexed: { name:"NSL01400Pemetrexed", drugs: [{ name:"Pemintas_Pemetrexed", dosePerM2:500,days:1}]},
NSL01500Carboplatin: { name:"NSL01500Carboplatin", drugs: [{ name:"Carboplatin", dosePerM2:5,days:1}]},
NHL00100Rituximab_MabSC: { name:"NHL00100Rituximab_MabSC", drugs: [{ name:"Mabthera_SC_Rituximab", fixedDose:1400,days:1}]},
NHL00100Rituximab: { name:"NHL00100Rituximab", drugs: [{ name:"Truxima_Rituximab", dosePerM2:375,days:1}]},
NHL00200CHOP: { name:"NHL00200CHOP", drugs: [{ name:"Vincristine", dosePerM2:1.4,days:1}, { name:"Doxorubicin", dosePerM2:50,days:1},{name:"Cyclophosphamide", dosePerM2:750,days:1},{name:"Methotrexate", dosePerM2:1,days:1,}],},
NHL00300CVP: { name:"NHL00300CVP", drugs: [{ name:"Cyclophosphamide", dosePerM2:750,days:1}, { name:"Vincristine", dosePerM2:1.4,days:1}]},
NHL00400EPOCH: { name:"NHL00400EPOCH", drugs: [{ name:"Etoposide", dosePerM2:50,days:1}, { name:"Vincristine", dosePerM2:0.4,days:1},{name:"Doxorubicin", dosePerM2:10,days:1},{name:"Cyclophosphamide", dosePerM2:750,days:1,}],},
NHL00500DAEPOCH: { name:"NHL00500DAEPOCH", drugs: [{ name:"Etoposide", dosePerM2:50,days:1}, { name:"Vincristine", dosePerM2:0.4,days:1},{name:"Doxorubicin", dosePerM2:10,days:1},{name:"Cyclophosphamide", dosePerM2:750,days:1,}],},
NHL00600DAEPOCH_vinblastine: { name:"NHL00600DAEPOCH_vinblastine", drugs: [{ name:"Etoposide", dosePerM2:50,days:1}, { name:"Vinblastine", dosePerM2:1.5,days:1},{name:"Doxorubicin", dosePerM2:10,days:1},{name:"Cyclophosphamide", dosePerM2:750,days:1,}],},
NHL00700DAEPOCH_CD4: { name:"NHL00700DAEPOCH_CD4", drugs: [{ name:"Etoposide", dosePerM2:50,days:1}, { name:"Vincristine", dosePerM2:0.4,days:1},{name:"Doxorubicin", dosePerM2:10,days:1},{name:"Cyclophosphamide", dosePerM2:750,days:1,}],},
NHL00800CHOEP: { name:"NHL00800CHOEP", drugs: [{ name:"Vincristine", dosePerM2:1.4,days:1}, { name:"Doxorubicin", dosePerM2:50,days:1},{name:"Cyclophosphamide", dosePerM2:750,days:1},{name:"Etoposide", dosePerM2:100,days:1,}],},
NHL00900HyperCVAD: { name:"NHL00900HyperCVAD", drugs: [{ name:"Mesna", dosePerM2:600,days:1}, { name:"Cyclophosphamide", dosePerM2:600,days:1},{name:"Vincristine", dosePerM2:2,days:1},{name:"Doxorubicin", dosePerM2:50,days:1},{name:"Methotrexate", dosePerM2:1,days:1,},{name:"Cytozar_Cytarabine", dosePerM2:1,days:1,},],},
NHL01000HyperCVAD: { name:"NHL01000HyperCVAD", drugs: [{ name:"Methylprednisolone", dosePerM2:100,days:1}, { name:"Methotrexate", dosePerM2:1000,days:1},{name:"Cytarabine", dosePerM2:6000,days:1},{name:"Leucovorin", dosePerM2:50,days:1,}],},
NHL01100CODOXM: { name:"NHL01100CODOX-M", drugs: [{ name:"Cyclophosphamide", dosePerM2:800,days:1}, { name:"Vincristine", dosePerM2:1.5,days:1},{name:"Doxorubicin", dosePerM2:40,days:1},{name:"Methotrexate", dosePerM2:1,days:1},{name:"Leucovorin", dosePerM2:15,days:1,},{name:"Cytozar_Cytarabine", dosePerM2:1,days:1,},],},
NHL01200IVAC: { name:"NHL01200IVAC", drugs: [{ name:"Etoposide", dosePerM2:60,days:1}, { name:"Ifosfamide", dosePerM2:1500,days:1},{name:"Mesna", dosePerM2:1500,days:1},{name:"Cytarabine", dosePerM2:2000,days:1},{name:"Methotrexate", dosePerM2:1,days:1,},],},
NHL01300BMAD: { name:"NHL01300B-MAD", drugs: [{ name:"Brentuximab", dosePerM2:18,days:1}, { name:"Methotrexate", dosePerM2:3000,days:1},{name:"Leucovorin", dosePerM2:200,days:1},{name:"Leunase_asparagenase", dosePerM2:6000,days:1,}],},
NHL01400AspaMetDex: { name:"NHL01400AspaMetDex", drugs: [{ name:"Leucovorin", dosePerM2:200,days:1}, { name:"Leunase_asparagenase", dosePerM2:6000,days:1,},{ name:"Methotrexate", dosePerM2:3000,days:1},]},
NHL01500Concurrent_BMAD: { name:"NHL01500Concurrent_B-MAD", drugs: [{ name:"Cisplatin", dosePerM2:30,days:1}]},
NHL01600CEOP: { name:"NHL01600CEOP", drugs: [{ name:"Vincristine", dosePerM2:1.4,days:1}, { name:"Cyclophosphamide", dosePerM2:750,days:1},{name:"Etoposide", dosePerM2:50,days:1},{name:"Etoposide_Oral", dosePerM2:0,days:1,}],},
NHL01700HD_MTX__AraC: { name:"NHL01700HD_MTX_+_AraC", drugs: [{ name:"Leucovorin", dosePerM2:15,days:1}, { name:"Cytarabine", dosePerM2:2000,days:1,},{ name:"Methotrexate", dosePerM2:500,days:1},]},
NHL01800HD_MTX: { name:"NHL01800HD_MTX", drugs: [{ name:"Leucovorin", dosePerM2:15,days:1}, { name:"Methotrexate", dosePerM2:500,days:1}]},
NHL01900ICE: { name:"NHL01900ICE", drugs: [{ name:"Etoposide", dosePerM2:100,days:1}, { name:"Carboplatin", dosePerM2:5,days:1},{name:"Ifosfamide", dosePerM2:5000,days:1},{name:"mesna", dosePerM2:5000,days:1,}],},
NHL02000ESHAP: { name:"NHL02000ESHAP", drugs: [{ name:"Methylprednisolone", fixedDose:500,days:1}, { name:"Etoposide", dosePerM2:40,days:1},{name:"Cisplatin", dosePerM2:25,days:1},{name:"Mannitol", fixedDose:100,days:1},{name:"Cytarabine", dosePerM2:2000,days:1,},],},
NHL02100mESHAP: { name:"NHL02100mESHAP", drugs: [{ name:"Methylprednisolone",  fixedDose:500,days:1}, { name:"Etoposide", dosePerM2:40,days:1},{name:"Cisplatin", dosePerM2:25,days:1},{name:"Mannitol", fixedDose:100,days:1},{name:"Cytarabine", dosePerM2:2000,days:1,},],},
NHL02200DHAP: { name:"NHL02200DHAP", drugs: [{ name:"Mannitol", dosePerM2:100,days:1}, { name:"Cytarabine", dosePerM2:2000,days:1,},{ name:"Cisplatin", dosePerM2:100,days:1},]},
NHL02300GIFOX: { name:"NHL02300GIFOX", drugs: [{ name:"Gemcitabine", dosePerM2:1000,days:1}, { name:"Oxaliplatin", dosePerM2:130,days:1},{name:"mesna", dosePerM2:9000,days:1},{name:"Ifosfamide", dosePerM2:5000,days:1,}],},
NHL02400IGEV: { name:"NHL02400IGEV", drugs: [{ name:"mesna", dosePerM2:2000,days:1}, { name:"Gemcitabine", dosePerM2:800,days:1,},{ name:"Ifosfamide", dosePerM2:2000,days:1},]},
NHL02500Gemox: { name:"NHL02500Gemox", drugs: [{ name:"Oxaliplatin", dosePerM2:100,days:1}, { name:"Gemcitabine", dosePerM2:1000,days:1}]},
NHL02600Bendamustine: { name:"NHL02600Bendamustine", drugs: [{ name:"Bendamustine", dosePerM2:0,days:1}]},
NHL02700Obinutuzumab: { name:"NHL02700Obinutuzumab", drugs: [{ name:"Obinutuzumab", dosePerM2:0,days:1}]},
NHL02800Brentuximab: { name:"NHL02800Brentuximab", drugs: [{ name:"Brentuximab", dosePerM2:1.8,days:1}]},
NHL02900Polatuzumab: { name:"NHL02900Polatuzumab", drugs: [{ name:"Polatuzumab", dosePerM2:1.4,days:1}]},
NHL03000MINE: { name:"NHL03000MINE", drugs: [{ name:"Etoposide", dosePerM2:80,days:1}, { name:"Mitoxanthrone", dosePerM2:10,days:1},{name:"Ifosfamide", dosePerM2:1500,days:1},{name:"mesna", dosePerM2:1500,days:1,}],},
NHL03100HDMTX__IFO: { name:"NHL03100HDMTX_+_IFO", drugs: [{ name:"Methotrexate", dosePerM2:500,days:1}, { name:"Leucovorin", dosePerM2:15,days:1},{name:"Ifosfamide", dosePerM2:1500,days:1},{name:"mesna", dosePerM2:1500,days:1,}],},
NHL03300HDMTX: { name:"NHL03300HDMTX", drugs: [{ name:"Leucovorin", dosePerM2:15,days:1}, { name:"Methotrexate", dosePerM2:500,days:1}]},




        
    };

    document.addEventListener('DOMContentLoaded', function() {
        initializeRegimenSelect($('.regimen'));
        $('#add-regimen-button').click(addRegimen);
        $('#reset-button').click(resetForm);
        $('#add-drug-button').click(addDrugSection);
        initializeDrugSelect($('.drugName'));
    });
    
    function initializeRegimenSelect(selectElement) {
        selectElement.empty();
        selectElement.append(new Option('เลือกสูตรยา หรือเพิ่มยาเดี่ยว', ''));
        for (const key in regimens) {
            const option = new Option(regimens[key].name, key);
            selectElement.append(option);
        }
        selectElement.select2();
    }
    
    function initializeDrugSelect(selectElement) {
        selectElement.empty();
        for (const key in drugs) {
            const option = new Option(key, key);
            selectElement.append(option);
        }
        selectElement.select2();
    }
    
    function addRegimen() {
        const newRegimenSection = `
            <div class="regimen-section">
                <label for="regimen">เลือกสูตรยา:</label>
                <select class="regimen" name="regimen">
                    <option value="">เลือกสูตรยา หรือเพิ่มยาเดี่ยว</option>
                </select>
            </div>
        `;
        $('#regimen-container').append(newRegimenSection);
        initializeRegimenSelect($('#regimen-container .regimen').last());
    }
    
    function addDrugSection() {
        const newDrugSection = 
        `
            <div class="drug-section1" >
                <div>
                    <label for="drugName">เลือกยา:</label>
                    <select class="drugName" name="drugName" required></select>
                </div>
                <div>
                    <label for="dosePerM2">ขนาดยา (mg/m²):</label>
                    <input type="number" class="dosePerM2" name="dosePerM2" step="1">
                </div>
            </div>
            <div class="drug-section" >
                <div>
                    <label for="days">จำนวนวัน:</label>
                    <input type="number" class="days" name="days" required>
                </div>
                <div>
                    <label for="fixedDose">ขนาดยา Fixed dose (mg) (ถ้าไม่ต้องคำนวนด้วย BSA):</label>
                    <input type="number" class="fixedDose" name="fixedDose" step="1">
                </div>
            </div>

        `;
        $('#drug-container').append(newDrugSection);
        initializeDrugSelect($('#drug-container .drugName').last());
    }
    
    function resetForm() {
        $('#weight').val('');
        $('#height').val('');
        $('#age').val('');
        $('#gender').val('');
        $('#serumCreatinine').val('');
        $('#regimen-container').html(`
            <div class="regimen-section">
                <label for="regimen">เลือกสูตรยา:</label>
                <select class="regimen" name="regimen">
                    <option value="">เลือกสูตรยา หรือเพิ่มยาเดี่ยว</option>
                </select>
            </div>
        `);
        $('#drug-container').empty();
        initializeRegimenSelect($('.regimen'));
        $('#result').hide();
        $('#age, #gender, #serumCreatinine').hide().prop('required', false);
    }
    
    function calculateRegimen() {
        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);
    
        if (isNaN(weight) || isNaN(height)) {
            alert("Please enter valid numbers.");
            return;
        }
    
        let requiresCrCl = false;
    
        $('#regimen-container .regimen').each(function() {
            const regimenKey = $(this).val();
            if (regimenKey) {
                const regimen = regimens[regimenKey];
    
                regimen.drugs.forEach(drugItem => {
                    if (drugItem.name === 'Carboplatin') {
                        requiresCrCl = true;
                    }
                });
            }
        });
    
        if (requiresCrCl) {
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const serumCreatinine = parseFloat(document.getElementById('serumCreatinine').value);
    
            if (isNaN(age) || isNaN(serumCreatinine) || !gender) {
                alert("Please enter valid age, gender, and serum creatinine values.");
                return;
            }
        }
    
        const bsa = Math.sqrt((weight * height) / 3600).toFixed(2);
        let totalCost = 0;
        let resultHTML = `BSA: ${bsa} m²<br><br>`;
        let drugDetailsHTML = '';
    
        $('#regimen-container .regimen').each(function() {
            const regimenKey = $(this).val();
            if (regimenKey) {
                const regimen = regimens[regimenKey];
    
                regimen.drugs.forEach(drugItem => {
                    const drug = drugs[drugItem.name];
    
                    let dose = drugItem.dosePerM2 * bsa;
                    if (drugItem.fixedDose) {
                        dose = drugItem.fixedDose;
                    }
                    if (drugItem.name === 'Vincristine' && dose > drugItem.maxDose) {
                        dose = drugItem.maxDose;
                    }
    
                    // Calculate creatinine clearance if the drug is Carboplatin
                    if (drugItem.name === 'Carboplatin') {
                        const age = parseInt(document.getElementById('age').value);
                        const gender = document.getElementById('gender').value;
                        const serumCreatinine = parseFloat(document.getElementById('serumCreatinine').value);
                        const creatinineClearance = calculateCreatinineClearance(weight, age, serumCreatinine, gender);
                        const adjustedCreatinineClearance = (parseFloat(creatinineClearance) + 25).toFixed(2)
                        dose = adjustedCreatinineClearance * drugItem.dosePerM2;
                        resultHTML += `Creatinine Clearance: ${creatinineClearance} mL/min<br>`;
                        
                    }
    
                    let totalDose;
                    if (drug.uom == 'เม็ด') {
                        const dailyDose = Math.ceil(dose / drug.vials[0].size) * drug.vials[0].size;
                        totalDose = dailyDose * drugItem.days;
                    } else {
                        totalDose = (dose * drugItem.days).toFixed(2);
                    }
    
                    const [cost, details] = calculateCheapestCost(totalDose, drug);
                    totalCost += cost;
    
                    drugDetailsHTML += `
                        <strong>${drugItem.name}</strong><br>
                        ใช้ยาทั้งหมด ${totalDose} mg<br>
                        ราคารวม ${formatCurrency(cost)} บาท<br>
                        ใช้ยาขนาด ${details}<br>
                        <br>
                    `;
                });
            }
        });
    
        $('#drug-container .drug-section').each(function() {
            const drugName = $(this).find('.drugName').val();
            const dosePerM2 = parseFloat($(this).find('.dosePerM2').val());
            const fixedDose = parseFloat($(this).find('.fixedDose').val());
            const days = parseInt($(this).find('.days').val());
    
            if (!drugName || isNaN(days) || (isNaN(dosePerM2) && isNaN(fixedDose))) {
                alert("Please enter valid drug information.");
                return;
            }
    
            const drug = drugs[drugName];
            let dose = dosePerM2 ? dosePerM2 * bsa : fixedDose;
    
            let totalDose;
            if (drug.uom === 'เม็ด') {
                const dailyDose = Math.ceil(dose / drug.vials[0].size) * drug.vials[0].size;
                totalDose = dailyDose * days;
            } else {
                totalDose = (dose * days).toFixed(2);
            }
    
            const [cost, details] = calculateCheapestCost(totalDose, drug);
            totalCost += cost;
    
            drugDetailsHTML += `
                <strong>${drugName}</strong><br>
                ใช้ยาทั้งหมด ${totalDose} mg<br>
                ราคารวม ${formatCurrency(cost)} บาท<br>
                ใช้ยาขนาด ${details}<br>
                <br>
            `;
        });
    
        resultHTML += `<strong>ราคายา รวมต่อ 1 รอบการรักษา: ${formatCurrency(totalCost)} บาท</strong><br><br>`;
        resultHTML += drugDetailsHTML;
    
        document.getElementById('result').innerHTML = resultHTML;
        document.getElementById('result').style.display = 'block';
    }
    
    function calculateCreatinineClearance(weight, age, serumCreatinine, gender) {
        let crCl = ((140 - age) * weight) / (72 * serumCreatinine);
        if (gender === 'female') {
            crCl *= 0.85;
        }
        return crCl.toFixed(2);
    }
    
    function calculateCheapestCost(dose, drug) {
        const vials = drug.vials;
        if (vials.length === 1) {
            const vialCount = Math.ceil(dose / vials[0].size);
            return [vialCount * vials[0].cost, `${vials[0].size} mg จำนวน ${vialCount} ${drug.uom}`];
        }
    
        let minCost = Infinity;
        let bestCombination = '';
    
        for (let i = 0; i <= Math.ceil(dose / vials[0].size); i++) {
            for (let j = 0; j <= Math.ceil(dose / (vials[1]?.size || Infinity)); j++) {
                const totalDose = (i * vials[0].size) + (j * (vials[1]?.size || 0));
                if (totalDose >= dose) {
                    const cost = (i * vials[0].cost) + (j * (vials[1]?.cost || 0));
                    if (cost < minCost) {
                        minCost = cost;
                        bestCombination = `${vials[0].size} mg จำนวน ${i} ${drug.uom}` + (j > 0 ? `, ${vials[1]?.size || 0} mg จำนวน ${j} ${drug.uom}` : '');
                    }
                }
            }
        }
    
        return [minCost, bestCombination];
    }
    
    function formatCurrency(value) {
        return new Intl.NumberFormat('th-TH', { style: 'decimal', minimumFractionDigits: 2 }).format(value);
    }
    
    $(document).on('change', '.regimen', function() {
        const regimenKey = $(this).val();
        if (regimenKey) {
            const regimen = regimens[regimenKey];
    
            let showCrClFields = false;
    
            regimen.drugs.forEach(drugItem => {
                if (drugItem.name === 'Carboplatin') {
                    showCrClFields = true;
                }
            });
    
            if (showCrClFields) {
                $('#age, #gender, #serumCreatinine,#Lage,#Lgen,#Lscr').show().prop('required', true);
            } else {
                $('#age, #gender, #serumCreatinine,#Lage,#Lgen,#Lscr').hide().prop('required', false);
            }
        } else {
            $('#age, #gender, #serumCreatinine,#Lage,#Lgen,#Lscr').hide().prop('required', false);
        }
    });
