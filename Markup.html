<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Mark up กรมบัญชีกลาง</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@100;300&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx-populate/1.22.0/xlsx-populate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstr
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            padding: 20px;
        }
        .result-row {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .shortcut-info {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 10px;
        }
        .reference-table {
            font-size: 0.9em;
            margin-top: 20px;
        }
                .card-header {
    /* Basic Structure */
    padding: 1rem 1.5rem;
    margin-bottom: 0;
    border-radius: 0.375rem 0.375rem 0 0;

    /* Background Options */
    background-color: #0056b3;  /* Bootstrap-like red */
    /* Alternative red options */
    /* background-color: #ff4444; -- Brighter red */
    /* background: linear-gradient(45deg, #dc3545, #c82333); -- Gradient */

    /* Text Styling */
    color: #ffffff;
    font-size: 1.1rem;
    font-weight: 500;
    line-height: 1.5;

    /* Modern Touches */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: all 0.3s ease;

    /* Flexbox for alignment */
    display: flex;
    align-items: center;
    justify-content: space-between;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header">
                        <h3 class="mb-0">โปรแกรมคำนวนราคา Mark up กรมบัญชีกลาง</h3>
                    </div>
                    <div class="card-body">
                        <div id="input-container">
                            <div class="input-group mb-3">
                                <input type="number" class="form-control cost-input" step="0.01" min="0" placeholder="ราคาต้นทุน">
                                <button class="btn btn-outline-danger remove-row" type="button">ลบ</button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <button class="btn btn-success" onclick="addNewRow()">เพิ่มรายการ</button>
                            <button class="btn btn-primary" onclick="calculateAll()">คำนวณทั้งหมด</button>
                            <button class="btn btn-success" onclick="exportToExcel()">Export to Excel</button>
                        </div>

                        <div class="shortcut-info">
                            <p>Shortcuts:</p>
                            <ul>
                                <li>กด Enter เพื่อคำนวณ</li>
                                <li>กด Ctrl + Enter เพื่อเพิ่มรายการ</li>
                                <li>สามารถ Copy และ Paste จาก Excel ได้โดยตรง</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    <script>
        // Handle paste events
        document.addEventListener('paste', function(e) {
            e.preventDefault();
            let clipboardData = e.clipboardData || window.clipboardData;
            let pastedData = clipboardData.getData('text');
            let rows = pastedData.split(/\r\n|\r|\n/).filter(row => row.trim());
            
            const container = document.getElementById('input-container');
            while (container.children.length > 1) {
                container.removeChild(container.lastChild);
            }
            
            if (rows.length > 0) {
                const firstInput = document.querySelector('.cost-input');
                firstInput.value = parseFloat(rows[0].replace(',', '.')) || '';
            }
            
            for (let i = 1; i < rows.length; i++) {
                let value = parseFloat(rows[i].replace(',', '.'));
                if (!isNaN(value)) {
                    addNewRow(value.toString());
                }
            }
            calculateAll();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.ctrlKey) {
                calculateAll();
            }
            if (e.key === 'Enter' && e.ctrlKey) {
                addNewRow();
            }
        });

        function calculateSingle(cost) {
            let reimbursement = 0;
            cost = parseFloat(cost);
            
            if (cost >= 0.01 && cost <= 0.20) {
                reimbursement = 0.50;
            } else if (cost <= 0.50) {
                reimbursement = 1.00;
            } else if (cost <= 1.00) {
                reimbursement = 1.50;
            } else if (cost <= 10.00) {
                reimbursement = 1.50 + ((cost - 1) * 1.25);
            } else if (cost <= 100.00) {
                reimbursement = 13 + ((cost - 10) * 1.20);
            } else if (cost <= 1000.00) {
                reimbursement = 126 + ((cost - 100) * 1.15);
            } else {
                reimbursement = 1161 + ((cost - 1000) * 1.10);
            }

            // Apply rounding rules
            if (cost < 10) {
                reimbursement = Math.ceil(reimbursement * 4) / 4; // Round to 0.25
            } else if (cost <= 100) {
                reimbursement = Math.ceil(reimbursement * 2) / 2; // Round to 0.50
            } else {
                reimbursement = Math.ceil(reimbursement * 2) / 2; // Round to 0.50
            }

            return reimbursement;
        }

        function addNewRow(value = '') {
            const container = document.getElementById('input-container');
            const newRow = document.createElement('div');
            newRow.className = 'input-group mb-3';
            newRow.innerHTML = `
                <input type="number" class="form-control cost-input" step="0.01" min="0" 
                       placeholder="ราคาต้นทุน" value="${value}">
                <button class="btn btn-outline-danger remove-row" type="button">ลบ</button>
            `;
            container.appendChild(newRow);

            newRow.querySelector('.remove-row').addEventListener('click', function() {
                newRow.remove();
            });

            if (!value) {
                newRow.querySelector('input').focus();
            }
        }

function calculateAll() {
    const inputs = document.querySelectorAll('.cost-input');
    const resultsContainer = document.getElementById('results-container');
    resultsContainer.innerHTML = '<h4>ราคาที่คำนวนได้</h4>'; // Move header outside the loop

    inputs.forEach((input, index) => {
        const cost = parseFloat(input.value);
        if (!isNaN(cost)) {
            const reimbursement = calculateSingle(cost);
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result-row';
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col">รายการที่ ${index + 1}</div>
                    <div class="col">ราคาต้นทุน: ${cost.toFixed(2)} บาท</div>
                    <div class="col">ราคาที่เบิกได้: ${reimbursement.toFixed(2)} บาท</div>
                </div>
            `;
            resultsContainer.appendChild(resultDiv);
        }
    });
}

        function exportToExcel() {
            const inputs = document.querySelectorAll('.cost-input');
            let data = [['ราคาต้นทุน', 'ราคาขาย']];

            inputs.forEach(input => {
                const cost = parseFloat(input.value);
                if (!isNaN(cost)) {
                    const reimbursement = calculateSingle(cost);
                    data.push([
                        Number(cost.toFixed(2)),
                        Number(reimbursement.toFixed(2))
                    ]);
                }
            });

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Prices");

            ws['!cols'] = [
                {wch: 15},
                {wch: 15}
            ];

            XLSX.writeFile(wb, "price_calculations.xlsx");
        }

        // Initialize first remove button
        document.querySelector('.remove-row').addEventListener('click', function(e) {
            e.target.parentElement.remove();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

