<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <title>โปรแกรมคำนวนราคา Mark up กรมบัญชีกลาง</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            padding: 20px;
        }
        .result-row {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">โปรแกรมคำนวนราคา Mark up กรมบัญชีกลาง</h3>
                    </div>
                    <div class="card-body">
                        <div id="input-container">
                            <div class="input-group mb-3">
                                <input type="number" class="form-control cost-input" step="0.01" min="0" placeholder="ราคาต้นทุน">
                                <button class="btn btn-outline-danger remove-row" type="button">ลบ</button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <button class="btn btn-success" onclick="addNewRow()">
                                <i class="bi bi-plus-circle"></i> เพิ่มรายการ
                            </button>
                            <button class="btn btn-primary" onclick="calculateAll()">คำนวนราคา Mark up</button>
                        </div>

                        <div id="results" class="mt-4">
                            <h4>ราคาที่คำนวนได้ธ์</h4>
                            <div id="results-container"></div>
                            <div id="total-result" class="mt-3 fw-bold"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// Add event listeners for keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Enter key for calculation
    if (e.key === 'Enter' && !e.ctrlKey) {
        calculateAll();
    }
    // Ctrl + Enter for adding new row
    if (e.key === 'Enter' && e.ctrlKey) {
        addNewRow();
    }
});

// Add event listener to all input fields for paste functionality
document.addEventListener('input', function(e) {
    if (e.target.classList.contains('cost-input')) {
        // Handle pasted content
        const value = e.target.value;
        if (value.includes('\n')) {
            const values = value.split('\n').filter(v => v.trim());
            e.target.value = values[0];
            
            // Add new rows for additional values
            values.slice(1).forEach(val => {
                addNewRow(val);
            });
        }
    }
});

function addNewRow(value = '') {
    const container = document.getElementById('input-container');
    const newRow = document.createElement('div');
    newRow.className = 'input-group mb-3';
    newRow.innerHTML = `
        <input type="number" class="form-control cost-input" step="0.01" min="0" placeholder="ราคาต้นทุน" value="${value}">
        <button class="btn btn-outline-danger remove-row" type="button">ลบ</button>
    `;
    container.appendChild(newRow);

    // Add event listener to remove button
    newRow.querySelector('.remove-row').addEventListener('click', function() {
        newRow.remove();
    });

    // Focus on the new input
    newRow.querySelector('input').focus();
}

function calculateSingle(cost) {
    let reimbursement = 0;
    
    // Base calculation
    if (cost >= 0 && cost <= 0.20) {
        reimbursement = 0.50;
    } else if (cost <= 0.50) {
        reimbursement = 1.00;
    } else if (cost <= 1.00) {
        reimbursement = 1.50;
    } else if (cost <= 10.00) {
        reimbursement = 1.50 + ((cost - 1) * 1.25);
    } else if (cost <= 100.00) {
        reimbursement = 13 + ((cost - 10) * 1.20);
    } else if (cost <= 1000.00) {
        reimbursement = 126 + ((cost - 100) * 1.15);
    } else {
        reimbursement = 1161 + ((cost - 1000) * 1.10);
    }

    // Additional rounding rules
    if (cost < 10) {
        reimbursement = Math.ceil(reimbursement * 4) / 4; // Round up to nearest 0.25 baht
    } else if (cost <= 100) {
        reimbursement = Math.ceil(reimbursement * 2) / 2; // Round up to nearest 0.50 baht
    } else {
        reimbursement = Math.ceil(reimbursement * 2) / 2; // Round up to nearest 0.50 baht
    }

    return reimbursement;
}

function calculateAll() {
    const inputs = document.querySelectorAll('.cost-input');
    const resultsContainer = document.getElementById('results-container');
    resultsContainer.innerHTML = '';

    inputs.forEach((input, index) => {
        const cost = parseFloat(input.value);
        if (!isNaN(cost)) {
            const reimbursement = calculateSingle(cost);
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result-row';
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col">รายการที่ ${index + 1}</div>
                    <div class="col">ราคาต้นทุน: ${cost.toFixed(2)} บาท</div>
                    <div class="col">ราคาที่เบิกได้: ${reimbursement.toFixed(2)} บาท</div>
                </div>
            `;
            resultsContainer.appendChild(resultDiv);
        }
    });
}

        // Add event listener to initial remove button
        document.querySelector('.remove-row').addEventListener('click', function(e) {
            e.target.parentElement.remove();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
